<!DOCTYPE html>
<html>
<head>
  <title>SVG Composer – A4 Layout</title>
  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>

<style>

body {
  font-family: 'Source Code Pro', monospace;
  margin: 0;
  height: 100vh;
  display: flex;
  flex-direction: column;
  background-color: #F9F8FB;
  color: #2E2E2E;
  overflow: hidden;
}

#navbar {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 40px;
  background: #2E2E2E;
  color: #D6CFE1;
  padding: 10px 20px;
  display: flex;
  gap: 20px;
  align-items: center;
  z-index: 10;
}

#navbar a {
  color: #D6CFE1;
  text-decoration: none;
  font-weight: bold;
  font-size: 0.95rem;
}

#navbar a.active {
  background-color: #9E4A4F;
  padding: 6px 12px;
  border-radius: 5px;
}

#main-content {
  display: flex;
  flex-direction: row;
  height: calc(100vh - 60px); /* below navbar */
  margin-top: 60px;
}

#composer-toolbar {
  width: 400px;
  height: 100%;
  overflow-y: auto;
  overflow-x: hidden;
  background: #F3F1F8;
  padding: 15px 12px;
  display: block; /* key change */
  scroll-behavior: smooth;
  padding-bottom: 100px;
}



.toolbar-section {
  background: #F3F1F8;
  border: 1px solid #D6CFE1;
  padding: 10px;
  border-radius: 6px;
}

.toolbar-section strong {
  display: block;
  margin-bottom: 6px;
  font-weight: bold;
  color: #2E2E2E;
}

.toolbar-row {
  margin-top: 10px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
}

input[type="text"], input[type="file"] {
  font-family: 'Source Code Pro', monospace;
  background-color: #D6CFE1;
  border: 1px solid #2E2E2E;
  color: #2E2E2E;
  padding: 6px 10px;
  border-radius: 4px;
  transition: background-color 0.2s, border-color 0.2s;
  max-width: 40%;
  flex: 1;
}

input[type="text"]:focus,
input[type="file"]:focus {
  outline: none;
  border-color: #9E4A4F;
  background-color: #ECE6F3;
}

button {
  font-family: 'Source Code Pro', monospace;
  background-color: #D6CFE1;
  border: 1px solid #2E2E2E;
  color: #2E2E2E;
  padding: 6px 10px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s, border-color 0.2s;
}

button:hover {
  background-color: #C9C1D8;
  border-color: #9E4A4F;
}

#composer-area {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #EEE;
  position: relative;
  overflow: hidden;
}

.paper-wrapper {
  width: 1122px;
  height: 794px;
  box-shadow: 0 0 0 2px #999;
  background: white;
  position: relative;
}

.paper-wrapper svg {
  position: absolute;
  top: 0;
  left: 0;
  width: 1122px;
  height: 794px;
}

#graphics-svg {
  pointer-events: auto;
}

#user-svg {
  pointer-events: none;
}
</style>

</head>

<body>
  <div id="navbar">
    <a href="/" >Home</a>
    <a href="/kicad">KiCad Layers</a>
    <a href="/editor">SVG Pin Editor</a>
    <a href="/composer" class="active">SVG Composer</a>
  </div>

  <div id="main-content">
    <div id="composer-toolbar">

      <!-- Layer modes -->
      <div class="toolbar-section">
        <strong>Editor Tools</strong>
        <div class="toolbar-row">
          <button id="switch-layer">Layer: GRAPHICS</button>
          <button onclick="enableDeleteMode()">Delete Mode</button>
          <button onclick="clearPage()">Clear Page</button>
        </div>
      </div>
    
      <!-- SVG Transform Controls -->
      <div class="toolbar-section">
        <strong>Canvas Controls</strong>
        <div class="toolbar-row">
          <input type="file" id="svg-upload" accept=".svg">
          <button onclick="rotateSVG()">Rotate +90°</button>
          <button onclick="zoomIn()">Zoom In</button>
          <button onclick="zoomOut()">Zoom Out</button>
        </div>
      </div>
    
      <!-- Title + SKU -->
      <div class="toolbar-section">
        <strong>Title & SKU</strong>
        <div class="toolbar-row">
          <input type="text" id="title-input" placeholder="Enter title (e.g. DasDuino Core)">
          <input type="text" id="sku-input" placeholder="Enter SKU (e.g. 12345)">
          <input type="text" id="version-input" placeholder="Enter version (e.g. v1.0)">
          <button onclick="addTitleBox()">Add Title</button>
        </div>
      </div>
    
      <!-- Pin Legend -->
      <div class="toolbar-section">
        <strong>Pinout Legend</strong>
        <div class="toolbar-row">
          <button onclick="addPinLegend()">Pin Legend</button>
          <button onclick="addSolderedLogo()">Soldered Logo</button>
          <button onclick="addOpenSourceLogo()">Open Source</button>
        </div>
      </div>
    
      <!-- Jumpers -->
      <div class="toolbar-section">
        <strong>Jumper Descriptions</strong>
        <div class="toolbar-row" id="jumper-inputs">
          <!-- Jumper inputs dynamically inserted here -->
          <button onclick="addJumperDetails()">Render Jumpers</button>
          <button onclick="addJumperInput()">+</button>
          <button onclick="removeJumperInput()">−</button>
        </div>
      </div>
    
    <!-- Additional Info -->
    <div class="toolbar-section">
      <strong>Info & Warning Boxes</strong>
    
      <!-- Info Text Input Row -->
      <div class="toolbar-row">
        <input type="text" id="info-text" placeholder="Info text (e.g. Use external 3.3V)">
      </div>
    
      <!-- General Info Buttons Row -->
      <div class="toolbar-row">
        <button onclick="addGeneralInfo('R')">Add Info (Right)</button>
        <button onclick="addGeneralInfo('L')">Add Info (Left)</button>
      </div>
    
      <!-- Warning Buttons Row -->
      <div class="toolbar-row">
        <button onclick="addWarningInfo('R')">Add Warning (Right)</button>
        <button onclick="addWarningInfo('L')">Add Warning (Left)</button>
      </div>
    </div>


      <!-- Export Section -->
      <div class="toolbar-section">
        <strong>Export</strong>
        <div class="toolbar-row">
          <button onclick="downloadA4SVG()">Export as SVG</button>
          <button onclick="exportToPNG()">Export as PNG</button>
        </div>
      </div>    
    </div>

    <div id="composer-area">
      <div class="paper-wrapper">
        <svg id="graphics-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1122 794">
          <g id="graphics-layer"></g>
        </svg>
        <svg id="user-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1122 794">
          <g id="user-layer" transform="rotate(0 561 397)"></g>
        </svg>
      </div>
    </div>
  </div>


<script>
  const A4_WIDTH = 1122;
  const A4_HEIGHT = 794;

  const graphicsSVG = document.getElementById("graphics-svg");
  const graphicsLayer = document.getElementById("graphics-layer");
  const userSVG = document.getElementById("user-svg");
  const userLayer = document.getElementById("user-layer");
  const switchButton = document.getElementById("switch-layer");

  let currentLayer = "graphics";
  let currentRotation = 0;
  let panZoomInstance = null;
  let isDragging = false;
  let dragStart = { x: 0, y: 0 };
  let translate = { x: 0, y: 0 };

  let scaleFactor = 1;

  function updateLayerMode() {
    if (currentLayer === "graphics") {
      graphicsSVG.style.pointerEvents = "auto";
      userSVG.style.pointerEvents = "none";
      switchButton.textContent = "Layer: GRAPHICS";
    } else {
      graphicsSVG.style.pointerEvents = "none";
      userSVG.style.pointerEvents = "auto";
      switchButton.textContent = "Layer: USER";
    }
  }

  switchButton.addEventListener("click", () => {
    currentLayer = currentLayer === "graphics" ? "user" : "graphics";
    updateLayerMode();
  });

  updateLayerMode();

  loadComposerState();  // <<< Restores previous state if available

  // === your existing file upload handler, rotate, zoom, drag, etc. remain unchanged ===

  function saveComposerState() {
    const exportSVG = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    exportSVG.setAttribute("xmlns", "http://www.w3.org/2000/svg");
    exportSVG.setAttribute("viewBox", `0 0 ${A4_WIDTH} ${A4_HEIGHT}`);
    exportSVG.setAttribute("width", A4_WIDTH);
    exportSVG.setAttribute("height", A4_HEIGHT);
    exportSVG.setAttribute("preserveAspectRatio", "xMidYMid meet");

    const graphicsClone = graphicsLayer.cloneNode(true);
    const userClone = userLayer.cloneNode(true);

    exportSVG.appendChild(graphicsClone);
    exportSVG.appendChild(userClone);

    const svgString = new XMLSerializer().serializeToString(exportSVG);

    const state = {
      svg: svgString,
      transform: {
        rotation: currentRotation,
        scale: scaleFactor,
        translateX: translate.x,
        translateY: translate.y
      }
    };

    localStorage.setItem("composerSVG", JSON.stringify(state));
  }

  function loadComposerState() {
    const raw = localStorage.getItem("composerSVG");
    if (!raw) return;

    let state;
    try {
      state = JSON.parse(raw);
    } catch (e) {
      console.warn("Failed to parse saved composer state.");
      return;
    }

    const tempContainer = document.createElement("div");
    tempContainer.innerHTML = state.svg;
    const incomingSVG = tempContainer.querySelector("svg");
    if (!incomingSVG) return;

    graphicsLayer.innerHTML = "";
    userLayer.innerHTML = "";

    const children = incomingSVG.children;
    if (children.length >= 2) {
      const g1 = children[0];
      const g2 = children[1];
      if (g1.tagName === "g") graphicsLayer.append(...g1.childNodes);
      if (g2.tagName === "g") userLayer.append(...g2.childNodes);
    }

    // Restore transform state
    if (state.transform) {
      currentRotation = state.transform.rotation || 0;
      scaleFactor = state.transform.scale || 1;
      translate.x = state.transform.translateX || 0;
      translate.y = state.transform.translateY || 0;
      updateUserLayerTransform();
    }
    // Re-enable dragging for info and warning boxes
    graphicsLayer.querySelectorAll("g.draggable-info, g.draggable-warning").forEach(g => {
      makeSVGElementDraggable(g);
    });
  }

  window.addEventListener("beforeunload", saveComposerState);

  document.getElementById('svg-upload').addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file || !file.name.endsWith('.svg')) return;

    const reader = new FileReader();
    reader.onload = function(event) {
      const tempContainer = document.createElement("div");
      tempContainer.innerHTML = event.target.result;
      const incomingSVG = tempContainer.querySelector("svg");
      if (!incomingSVG) return;

      userLayer.innerHTML = "";

      while (incomingSVG.childNodes.length > 0) {
        userLayer.appendChild(incomingSVG.childNodes[0]);
      }

      // Reset transform
      currentRotation = 0;
      translate = { x: 0, y: 0 };
      updateUserLayerTransform();
    };

    reader.readAsText(file);
    saveComposerState()
  });

  function rotateSVG() {
    currentRotation = (currentRotation + 90) % 360;
    updateUserLayerTransform();
  }

  function zoomIn() {
    scaleFactor *= 1.1;
    updateUserLayerTransform();
  }

  function zoomOut() {
    scaleFactor /= 1.1;
    updateUserLayerTransform();
  }

  function updateUserLayerTransform() {
    const cx = A4_WIDTH / 2;
    const cy = A4_HEIGHT / 2;

    userLayer.setAttribute(
      "transform",
      `translate(${translate.x} ${translate.y}) rotate(${currentRotation} ${cx} ${cy}) scale(${scaleFactor})`
    );
    saveComposerState()
  }

  // Drag logic
  userLayer.addEventListener("mousedown", e => {
    if (currentLayer !== "user") return;
    isDragging = true;
    dragStart = { x: e.clientX, y: e.clientY };
  });

  window.addEventListener("mousemove", e => {
    if (!isDragging) return;
    const dx = e.clientX - dragStart.x;
    const dy = e.clientY - dragStart.y;
    dragStart = { x: e.clientX, y: e.clientY };
    translate.x += dx;
    translate.y += dy;
    updateUserLayerTransform();
  });

  window.addEventListener("mouseup", () => {
    isDragging = false;
  });

function addTitleBox() {
  const titleInput = document.getElementById("title-input");
  const skuInput = document.getElementById("sku-input");

  const rawTitle = titleInput.value.trim();
  const rawSKU = skuInput.value.trim();
  if (!rawTitle || !rawSKU) return;

  const versionInput = document.getElementById("version-input");
  const rawVersion = versionInput.value.trim();


  const title = rawTitle.toUpperCase();
  const skuText = `solde.red/${rawSKU}`;

  const group = document.createElementNS("http://www.w3.org/2000/svg", "g");

  // Naslovni ljubičasti pravokutnik
  const x1 = 30;
  const y = 30;
  const width1 = 800;
  const height = 50;
  const cut = 10;

  const titlePath = document.createElementNS("http://www.w3.org/2000/svg", "path");
  titlePath.setAttribute("d", `
    M${x1},${y} 
    H${x1 + width1} 
    V${y + height} 
    H${x1 + cut} 
    L${x1},${y + height - cut} 
    Z
  `);
  titlePath.setAttribute("fill", "#500B76");

  const titleText = document.createElementNS("http://www.w3.org/2000/svg", "text");
  titleText.setAttribute("x", x1 + width1 / 2);
  titleText.setAttribute("y", y + height / 2);
  titleText.setAttribute("text-anchor", "middle");
  titleText.setAttribute("dominant-baseline", "middle");
  titleText.setAttribute("fill", "white");
  titleText.setAttribute("font-size", "20");
  titleText.setAttribute("font-family", "Source Code Pro, monospace");

  const boldPart = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
  boldPart.setAttribute("font-weight", "bold");
  boldPart.textContent = title;

  const suffixPart = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
  suffixPart.setAttribute("font-weight", "normal");
  suffixPart.textContent = " - Pinout";

  titleText.appendChild(boldPart);
  titleText.appendChild(suffixPart);

  // Plavi pravokutnik sa SKU linkom
  const x2 = x1 + width1 + 20;
  const width2 = 240;

  const skuPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
  skuPath.setAttribute("d", `
    M${x2},${y} 
    H${x2 + width2} 
    V${y + height} 
    H${x2 + cut} 
    L${x2},${y + height - cut} 
    Z
  `);
  skuPath.setAttribute("fill", "#00C0DE");

  const skuTextEl = document.createElementNS("http://www.w3.org/2000/svg", "text");
  skuTextEl.setAttribute("x", x2 + width2 / 2);
  skuTextEl.setAttribute("y", y + height / 2 - 6);  // Slight upward shift to center both lines
  skuTextEl.setAttribute("text-anchor", "middle");
  skuTextEl.setAttribute("fill", "white");
  skuTextEl.setAttribute("font-size", "14");
  skuTextEl.setAttribute("font-family", "Source Code Pro, monospace");

  const line1 = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
  line1.setAttribute("x", x2 + width2 / 2);
  line1.setAttribute("dy", "0");
  line1.textContent = "full product documentation";

  const line2 = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
  line2.setAttribute("x", x2 + width2 / 2);
  line2.setAttribute("dy", "1.2em");
  line2.textContent = skuText;

  skuTextEl.appendChild(line1);
  skuTextEl.appendChild(line2);


  if (rawVersion) {
    const versionText = document.createElementNS("http://www.w3.org/2000/svg", "text");
    versionText.setAttribute("x", 860);         // lijeva margina plavog pravokutnika
    versionText.setAttribute("y", y + height + 40);  // ispod pravokutnika
    versionText.setAttribute("fill", "#00C0DE");
    versionText.setAttribute("font-size", "14");
    versionText.setAttribute("font-family", "Source Code Pro, monospace");
    versionText.textContent = rawVersion;

    group.appendChild(versionText);
  }

  // Dodaj sve elemente u zajedničku grupu
  group.appendChild(titlePath);
  group.appendChild(titleText);
  group.appendChild(skuPath);
  group.appendChild(skuTextEl);

  graphicsLayer.appendChild(group);
  saveComposerState()
}

function addPinLegend() {
  const startX = 850;
  const startY = 185;
  const boxSize = 16;
  const boxGap = 8;
  const textOffset = 10;

  const data = [
    { label: "Pin description", color: "#D1D2D4" },
    { label: "Power supply pin", color: "#EE4035" },
    { label: "Ground", color: "#221E1F" },
    { label: "Control", color: "#FED53E" },
    { label: "GPIO", color: "#88C284" },
    { label: "ADC pin", color: "#4777B9" },
    { label: "DAC pin", color: "#97B8DB" },
    { label: "SPI comms", color: "#E58F40" },
    { label: "UART comms", color: "#6A241F" },
    { label: "I2C comms", color: "#A75383" },
    { label: "PWM comms", color: "#2E3175" },
    { label: "Other", color: "#295A32" },
    { label: "Port name", color: "#ED008C" },
    { label: "General info", color: "#00C0DE" },
    { label: "Warning!", color: "#FFD700" }
  ];

  const group = document.createElementNS("http://www.w3.org/2000/svg", "g");

  const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
  line.setAttribute("x1", startX);
  line.setAttribute("y1", 100);
  line.setAttribute("x2", startX);
  line.setAttribute("y2", A4_HEIGHT);
  line.setAttribute("stroke", "#00C0DE");
  line.setAttribute("stroke-width", 2);
  group.appendChild(line);

  data.forEach((item, index) => {
    const y = startY + index * (boxSize + boxGap);
    const iconX = startX + 10;
    const iconY = y;

    if (item.label === "General info") {
      // Draw blue info icon
      const infoGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");

      const infoBox = document.createElementNS("http://www.w3.org/2000/svg", "path");
      infoBox.setAttribute("d", `M${iconX + 3},${iconY} H${iconX + 13} L${iconX + 16},${iconY + 3} V${iconY + 13} L${iconX + 13},${iconY + 16} H${iconX + 3} L${iconX},${iconY + 13} V${iconY + 3} Z`);
      infoBox.setAttribute("fill", "#00C0DE");
      infoGroup.appendChild(infoBox);

      const iText = document.createElementNS("http://www.w3.org/2000/svg", "text");
      iText.setAttribute("x", iconX + 8);
      iText.setAttribute("y", iconY + 11);
      iText.setAttribute("text-anchor", "middle");
      iText.setAttribute("font-size", "10");
      iText.setAttribute("font-family", "Source Code Pro, monospace");
      iText.setAttribute("fill", "white");
      iText.textContent = "i";
      infoGroup.appendChild(iText);

      group.appendChild(infoGroup);
    } else if (item.label === "Warning!") {
      // Draw yellow warning triangle
      const warningGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");

      const triangle = document.createElementNS("http://www.w3.org/2000/svg", "path");
      triangle.setAttribute("d", `M${iconX + 8},${iconY} L${iconX + 16},${iconY + 16} H${iconX} Z`);
      triangle.setAttribute("fill", "#FFD700");
      warningGroup.appendChild(triangle);

      const exclamation = document.createElementNS("http://www.w3.org/2000/svg", "text");
      exclamation.setAttribute("x", iconX + 8);
      exclamation.setAttribute("y", iconY + 14);
      exclamation.setAttribute("text-anchor", "middle");
      exclamation.setAttribute("font-size", "12");
      exclamation.setAttribute("font-family", "Source Code Pro, monospace");
      exclamation.setAttribute("fill", "black");
      exclamation.textContent = "!";
      warningGroup.appendChild(exclamation);

      group.appendChild(warningGroup);
    } else {
      // Default clipped square for other items
      const cut = 3;
      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute("d", `
        M${iconX},${iconY}
        H${iconX + boxSize}
        V${iconY + boxSize}
        H${iconX + cut}
        L${iconX},${iconY + boxSize - cut}
        Z
      `);
      path.setAttribute("fill", item.color);
      group.appendChild(path);
    }

    // Add label text
    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
    text.setAttribute("x", iconX + boxSize + textOffset);
    text.setAttribute("y", iconY + boxSize / 2);
    text.setAttribute("dominant-baseline", "middle");
    text.setAttribute("fill", "#500B76");
    text.setAttribute("font-size", "15");
    text.setAttribute("font-family", "Source Code Pro, monospace");
    text.textContent = item.label;
    group.appendChild(text);
  });

  graphicsLayer.appendChild(group);
  saveComposerState()
}

function addJumperInput() {
  const container = document.getElementById("jumper-inputs");
  const input = document.createElement("input");
  input.type = "text";
  input.placeholder = "Jumper description";
  input.style.maxWidth = "200px";
  container.appendChild(input);
}

function removeJumperInput() {
  const container = document.getElementById("jumper-inputs");
  const inputs = container.querySelectorAll("input");
  if (inputs.length > 0) {
    container.removeChild(inputs[inputs.length - 1]);
  }
}

function addSolderedLogo() {
  const svgNS = "http://www.w3.org/2000/svg";
  const group = document.createElementNS(svgNS, "g");
  group.setAttribute("transform", "translate(30, 620) scale(0.45)");

  // Triangle extending the rectangle visually (roof-like)
  const triangle = document.createElementNS(svgNS, "path");
  triangle.setAttribute("d", "M0 21 L120 -44 L240 21 Z");
  triangle.setAttribute("fill", "#500B76");
  group.appendChild(triangle);

  // Purple rectangle body
  const bg = document.createElementNS(svgNS, "rect");
  bg.setAttribute("x", "0");
  bg.setAttribute("y", "20");
  bg.setAttribute("width", "240");
  bg.setAttribute("height", "650");
  bg.setAttribute("fill", "#500B76");
  group.appendChild(bg);

  // Top S path (shifted right by 34px)
  const pathTop = document.createElementNS(svgNS, "path");
  pathTop.setAttribute("d", "M183.944 33.9609C179.575 33.9609 175.205 32.7691 171.63 30.7827L119.5943 0.589111L41.73877 45.8794V121.363L123.5665 168.64L125.5527 167.448C132.7027 163.873 137.867 155.927 137.867 147.981C137.867 140.036 133.1 130.898 125.9499 127.323L76.6943 100.705V65.3463L119.5943 40.3175L155.344 61.3735C158.919 63.3599 161.303 66.1409 163.686 69.7164C167.658 76.8675 175.205 81.2377 183.944 81.2377C191.889 81.2377 198.642 77.2648 203.011 71.3056C203.408 70.9083 203.805 70.1137 204.203 69.7164C204.203 69.7164 204.203 69.7165 204.203 69.3192C206.189 65.7436 207.38 61.7708 207.38 57.4007C207.38 44.6876 197.053 33.9609 183.944 33.9609Z");
  pathTop.setAttribute("fill", "white");

  // Bottom S path (shifted right by 34px)
  const pathBottom = document.createElementNS(svgNS, "path");
  pathBottom.setAttribute("d", "M116.4166 63.7572C109.2666 67.3328 104.1028 75.2784 104.1028 83.2241C104.1028 91.1698 108.8694 100.307 116.0194 103.883L165.275 130.501V165.859L122.375 190.888L86.625 169.832C83.05 167.845 80.6666 165.065 78.2833 161.489C74.3111 154.338 66.7639 149.968 58.025 149.968C50.0805 149.968 43.3278 153.941 38.95831 159.9C38.56109 160.297 38.16387 161.092 37.76665 161.489C37.76665 161.489 37.76665 161.489 37.76665 161.886C35.78053 165.462 34.588867 169.435 34.588867 173.805C34.588867 186.915 45.3139 197.642 58.4222 197.642C62.7916 197.642 66.7639 198.834 70.7361 200.82L122.7722 230.616L200.231 185.723V110.239L118.4028 62.9626L116.4166 63.7572Z");
  pathBottom.setAttribute("fill", "white");

  const textSub = document.createElementNS(svgNS, "text");
  textSub.textContent = "soldered.com";
  textSub.setAttribute("x", "83");
  textSub.setAttribute("y", "775");
  textSub.setAttribute("fill", "white");
  textSub.setAttribute("font-size", "12");
  textSub.setAttribute("font-family", "Source Code Pro, monospace");
  textSub.setAttribute("text-anchor", "middle");


  // Stylized SOLDERED logo (from SVG paths)
  const solderedGroup = document.createElementNS(svgNS, "g");
  solderedGroup.setAttribute("transform", "translate(47, 740) scale(0.08)"); // Adjust position & scale as needed

  const solderedPaths = [
    "M52.111 142.107C42.975 142.107 34.236 140.518 25.1 137.34C16.361 134.161 8.01902 128.997 0.869019 122.243L18.347 100.789C23.114 104.762 28.675 107.941 35.031 109.927C40.989 111.913 46.947 113.105 52.905 113.105C58.864 113.105 63.233 112.311 66.014 110.324C68.794 108.338 70.383 105.557 70.383 101.981C70.383 99.2 69.589 97.214 68 95.625C66.411 94.036 64.028 92.844 61.247 91.255C58.467 90.063 55.289 88.474 51.317 86.885L33.839 79.733C29.072 77.747 24.306 74.966 20.333 71.788C15.964 68.609 12.786 64.239 10.006 59.472C7.22501 54.705 6.03302 48.7453 6.03302 42.3888C6.03302 34.8404 8.01902 27.6893 12.389 21.73C16.758 15.3735 22.319 10.6061 29.867 6.6333C37.414 3.0577 45.756 1.0713 55.686 1.0713C64.028 1.0713 71.972 2.6604 79.519 5.4414C87.067 8.2224 94.217 12.5925 99.778 18.1545L82.3 40.0051C77.533 36.8268 73.164 34.0458 68.397 32.4567C64.028 30.8675 59.261 30.073 55.289 30.073C50.522 30.073 46.55 30.8676 43.769 32.854C40.989 34.8404 39.4 37.2241 39.4 40.7996C39.4 43.1833 40.194 45.1698 41.783 46.7589C43.372 48.348 45.755 49.9372 48.933 51.129C52.111 52.3209 55.686 53.91 59.658 55.499L76.739 62.253C82.3 64.637 87.067 67.418 91.039 70.596C95.011 74.171 98.189 78.144 100.175 82.912C102.161 87.679 103.353 93.241 103.353 99.598C103.353 107.146 101.367 114.297 97.394 120.654C93.422 127.01 87.464 132.572 79.519 136.545C72.767 140.121 63.233 142.107 52.111 142.107Z",
    "M176.839 113.105C182.797 113.105 187.564 111.516 191.933 107.94C196.303 104.365 199.48 99.598 201.864 93.241C204.247 86.884 205.042 79.336 205.042 70.596C205.042 61.856 203.85 54.307 201.864 48.348C199.48 42.3887 196.303 37.6213 191.933 34.443C187.564 31.2648 182.797 29.6756 176.839 29.6756C170.88 29.6756 166.114 31.2648 161.744 34.443C157.375 37.6213 154.197 42.3887 152.211 48.348C149.828 54.307 149.033 61.856 149.033 70.596C149.033 79.336 150.225 86.884 152.211 93.241C154.594 99.598 157.772 104.365 161.744 107.94C166.114 111.516 171.278 113.105 176.839 113.105ZM176.839 142.107C164.525 142.107 153.403 139.326 144.267 133.764C134.733 127.805 127.583 119.859 122.419 109.132C117.255 98.406 114.475 85.693 114.475 70.993C114.475 55.896 117.255 43.5806 122.419 32.8539C127.583 22.5245 135.13 14.5789 144.267 9.0169C153.8 3.4549 164.525 0.673996 176.839 0.673996C189.153 0.673996 200.275 3.4549 209.411 9.0169C218.944 14.5789 226.094 22.5245 231.258 32.8539C236.422 43.1833 239.203 55.896 239.203 70.993C239.203 85.693 236.422 98.406 231.258 109.132C226.094 119.859 218.547 127.805 209.411 133.764C200.275 139.326 189.55 142.107 176.839 142.107Z",
    "M390.942 112.708H394.914C402.064 112.708 408.419 111.516 413.981 109.132C419.542 106.749 423.911 102.379 427.089 96.419C430.267 90.46 431.856 82.117 431.856 70.993C431.856 60.267 430.267 51.9236 427.089 45.9644C423.911 40.0051 419.542 36.0323 413.981 33.6486C408.419 31.2649 402.064 30.073 394.914 30.073H390.942V112.708ZM357.575 139.326V3.0577H397.297C411.2 3.0577 423.117 5.4414 433.444 10.2088C443.772 14.9762 451.717 22.1273 457.675 32.0594C463.236 41.9915 466.414 54.705 466.414 70.596C466.414 86.487 463.633 99.2 457.675 109.53C452.114 119.462 444.169 127.01 433.842 132.175C423.911 136.942 411.994 139.326 398.886 139.326H357.575Z",
    "M481.508 139.326V3.0577H568.5V31.2649H515.272V55.499H560.556V83.706H515.272V111.516H570.883V139.723H481.508V139.326Z",
    "M622.125 29.6757H636.425C643.972 29.6757 649.533 30.8676 653.506 33.2513C657.478 35.635 659.464 40.0051 659.464 46.3616C659.464 52.7182 657.478 57.486 653.506 60.664C649.533 63.842 643.972 65.431 636.425 65.431H622.125V29.6757ZM699.583 139.326L669.394 85.295C675.75 82.117 681.311 77.747 685.283 72.185C690.05 65.431 692.831 56.691 692.831 46.3616C692.831 35.2377 690.447 26.4975 685.283 20.1409C680.517 13.7844 673.764 9.4143 665.819 7.0306C657.875 4.6469 648.739 3.0577 639.206 3.0577H588.361V139.326H621.728V92.049H637.219L661.847 139.326H699.583Z",
    "M712.294 139.326V3.0577H799.29V31.2649H746.058V55.499H791.34V83.706H746.058V111.516H801.67V139.723H712.294V139.326Z",
    "M850.93 112.708H854.9C862.05 112.708 868.4 111.516 873.96 109.132C879.53 106.749 883.89 102.379 887.07 96.419C890.25 90.46 891.84 82.117 891.84 70.993C891.84 60.267 890.25 51.9236 887.07 45.9644C883.89 40.0051 879.53 36.0323 873.96 33.6486C868.4 31.2649 862.05 30.073 854.9 30.073H850.93V112.708ZM817.56 139.326V3.0577H857.28C871.18 3.0577 883.1 5.4414 893.43 10.2088C903.76 14.9762 911.7 22.1273 917.66 32.0594C923.22 41.9915 926.4 54.705 926.4 70.596C926.4 86.487 923.62 99.2 917.66 109.53C912.1 119.462 904.15 127.01 893.83 132.175C883.89 136.942 871.98 139.326 858.87 139.326H817.56Z",
    "M305.936 108.338L287.664 90.063V3.0577H254.297V103.968L289.253 138.929H341.686V107.941H305.936V108.338Z"
  ];


  solderedPaths.forEach(d => {
    const path = document.createElementNS(svgNS, "path");
    path.setAttribute("d", d);
    path.setAttribute("fill", "white");
    solderedGroup.appendChild(path);
  });

  // Append these after all paths
  group.appendChild(pathTop);
  group.appendChild(pathBottom);


  graphicsLayer.appendChild(group);
  graphicsLayer.appendChild(solderedGroup);
  graphicsLayer.appendChild(textSub);
  saveComposerState()
}

function measureSVGTextWidth(textContent) {
  const tempText = document.createElementNS("http://www.w3.org/2000/svg", "text");
  tempText.setAttribute("x", 0);
  tempText.setAttribute("y", 0);
  tempText.setAttribute("font-size", "15");
  tempText.setAttribute("font-family", "Source Code Pro, monospace");
  tempText.setAttribute("visibility", "hidden");
  tempText.textContent = textContent;
  graphicsSVG.appendChild(tempText);
  const bbox = tempText.getBBox();
  graphicsSVG.removeChild(tempText);
  return bbox.width;
}

function addJumperDetails() {
  const inputs = document.querySelectorAll("#jumper-inputs input");
  const texts = Array.from(inputs)
    .map(i => i.value.trim())
    .filter(val => val !== "");

  if (texts.length === 0) return;

  const baseX = 30;
  const baseY = 90;
  const lineColor = "#00C0DE";
  const textColor = "#500B76";
  const blockHeight = 70;
  const rowHeight = 20;
  const columnGap = 0;
  const padding = 20;
  const minBlockWidth = 100;

  // Podijeli tekstove u blokove po 3
  const blocks = [];
  for (let i = 0; i < texts.length; i += 3) {
    blocks.push(texts.slice(i, i + 3));
  }

  // Izračunaj širine svih blokova unaprijed
  const blockWidths = blocks.map(block => {
    const longest = block.reduce((a, b) =>
      measureSVGTextWidth(a) > measureSVGTextWidth(b) ? a : b, "");
    return Math.max(minBlockWidth, measureSVGTextWidth(longest) + padding * 2);
  });

  // Nacrtaj blokove
  const group = document.createElementNS("http://www.w3.org/2000/svg", "g");

  let currentX = baseX;

  blocks.forEach((block, index) => {
    const blockWidth = blockWidths[index];
    const y = baseY;
    const x = currentX;

    // Gornja linija
    const topLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
    topLine.setAttribute("x1", x);
    topLine.setAttribute("y1", y);
    topLine.setAttribute("x2", x + blockWidth);
    topLine.setAttribute("y2", y);
    topLine.setAttribute("stroke", lineColor);
    topLine.setAttribute("stroke-width", 2);
    group.appendChild(topLine);

    // Donja linija
    const bottomLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
    bottomLine.setAttribute("x1", x);
    bottomLine.setAttribute("y1", y + blockHeight);
    bottomLine.setAttribute("x2", x + blockWidth);
    bottomLine.setAttribute("y2", y + blockHeight);
    bottomLine.setAttribute("stroke", lineColor);
    bottomLine.setAttribute("stroke-width", 2);
    group.appendChild(bottomLine);

    // Tekstovi unutar bloka
    block.forEach((line, i) => {
      const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
      text.setAttribute("x", x + 10);
      text.setAttribute("y", y + 20 + i * rowHeight);
      text.setAttribute("fill", textColor);
      text.setAttribute("font-size", "15");
      text.setAttribute("font-family", "Source Code Pro, monospace");
      text.textContent = line;
      group.appendChild(text);
    });

    // Pripremi x za sljedeći blok
    currentX += blockWidth + columnGap;
  });

  graphicsLayer.appendChild(group);
  saveComposerState()
}


function makeSVGElementDraggable(el) {
  let offset = null;
  let isDragging = false;

  el.addEventListener("mousedown", e => {
    isDragging = true;
    const CTM = graphicsSVG.getScreenCTM();
    offset = {
      x: e.clientX - (CTM.a * el.transform.baseVal[0]?.matrix.e || 0),
      y: e.clientY - (CTM.d * el.transform.baseVal[0]?.matrix.f || 0)
    };
    e.preventDefault();
  });

  window.addEventListener("mousemove", e => {
    if (!isDragging) return;
    const dx = e.clientX - offset.x;
    const dy = e.clientY - offset.y;
    const CTM = graphicsSVG.getScreenCTM();
    const svgX = dx / CTM.a;
    const svgY = dy / CTM.d;
    el.setAttribute("transform", `translate(${svgX}, ${svgY})`);
  });

  window.addEventListener("mouseup", () => {
    isDragging = false;
  });
}


function addGeneralInfo(direction = "R") {
  const infoText = document.getElementById("info-text").value.trim();
  if (!infoText) return;

  const maxLineWidth = 120;
  const fontSize = 15;
  const lineHeight = 20;
  const padding = 6;
  const iconSize = 16;
  const gap = 6;

  function wrapText(text, maxWidth) {
    const words = text.split(" ");
    const lines = [];
    let currentLine = "";

    for (let word of words) {
      const testLine = currentLine ? currentLine + " " + word : word;
      const width = measureSVGTextWidth(testLine);
      if (width <= maxWidth) {
        currentLine = testLine;
      } else {
        if (currentLine) lines.push(currentLine);
        currentLine = word;
      }
    }
    if (currentLine) lines.push(currentLine);
    return lines;
  }

  const lines = wrapText(infoText, maxLineWidth);
  const textBlockWidth = maxLineWidth;
  const totalTextHeight = lines.length * lineHeight;
  const totalHeight = Math.max(iconSize, totalTextHeight);
  const totalWidth = iconSize + gap + textBlockWidth;

  const cx = 150;
  const cy = 300;
  const groupX = cx - totalWidth / 2;
  const groupY = cy - totalHeight / 2;

  const iconX = direction === "L" ? groupX + textBlockWidth + gap : groupX;
  const iconY = groupY + (totalHeight - iconSize) / 2;

  const textX = direction === "L" ? groupX : groupX + iconSize + gap;

  const group = document.createElementNS("http://www.w3.org/2000/svg", "g");
  group.setAttribute("class", "draggable-info");
  group.setAttribute("cursor", "move");

  const cut = 3;
  const iconPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
  iconPath.setAttribute("d", `
    M${iconX + cut},${iconY}
    H${iconX + iconSize - cut}
    L${iconX + iconSize},${iconY + cut}
    V${iconY + iconSize - cut}
    L${iconX + iconSize - cut},${iconY + iconSize}
    H${iconX + cut}
    L${iconX},${iconY + iconSize - cut}
    V${iconY + cut}
    L${iconX + cut},${iconY}
    Z
  `);
  iconPath.setAttribute("fill", "#00C0DE");

  const iconText = document.createElementNS("http://www.w3.org/2000/svg", "text");
  iconText.setAttribute("x", iconX + iconSize / 2);
  iconText.setAttribute("y", iconY + iconSize / 2 + 1);
  iconText.setAttribute("text-anchor", "middle");
  iconText.setAttribute("dominant-baseline", "middle");
  iconText.setAttribute("font-size", "12");
  iconText.setAttribute("fill", "white");
  iconText.setAttribute("font-family", "Source Code Pro, monospace");
  iconText.textContent = "i";

  // RIGHT-align text for left-side placement
  lines.forEach((line, i) => {
    const textEl = document.createElementNS("http://www.w3.org/2000/svg", "text");
    textEl.setAttribute("x", direction === "L" ? textX + maxLineWidth : textX);
    textEl.setAttribute("y", groupY + i * lineHeight + fontSize);
    textEl.setAttribute("fill", "#500B76");
    textEl.setAttribute("font-size", fontSize);
    textEl.setAttribute("font-family", "Source Code Pro, monospace");
    textEl.setAttribute("text-anchor", direction === "L" ? "end" : "start");
    textEl.textContent = line;
    group.appendChild(textEl);
  });

  group.appendChild(iconPath);
  group.appendChild(iconText);
  makeSVGElementDraggable(group);
  graphicsLayer.appendChild(group);
  saveComposerState()
}

function exportToPNG() {
  const PNG_WIDTH = 2500;
  const PNG_HEIGHT = Math.round(2500 * (A4_HEIGHT / A4_WIDTH)); // maintain A4 aspect ratio

  const exportSVG = document.createElementNS("http://www.w3.org/2000/svg", "svg");
  exportSVG.setAttribute("xmlns", "http://www.w3.org/2000/svg");
  exportSVG.setAttribute("viewBox", `0 0 ${A4_WIDTH} ${A4_HEIGHT}`);
  exportSVG.setAttribute("width", A4_WIDTH);
  exportSVG.setAttribute("height", A4_HEIGHT);
  exportSVG.setAttribute("preserveAspectRatio", "xMidYMid meet");

  const graphicsClone = graphicsLayer.cloneNode(true);
  const userClone = userLayer.cloneNode(true);
  exportSVG.appendChild(graphicsClone);
  exportSVG.appendChild(userClone);

  const svgString = new XMLSerializer().serializeToString(exportSVG);
  const svgBlob = new Blob([svgString], { type: "image/svg+xml;charset=utf-8" });
  const url = URL.createObjectURL(svgBlob);

  const img = new Image();
  img.onload = function () {
    const canvas = document.createElement("canvas");
    canvas.width = PNG_WIDTH;
    canvas.height = PNG_HEIGHT;

    const ctx = canvas.getContext("2d");
    ctx.fillStyle = "white";
    ctx.fillRect(0, 0, PNG_WIDTH, PNG_HEIGHT);
    ctx.drawImage(img, 0, 0, PNG_WIDTH, PNG_HEIGHT);

    const rawTitle = document.getElementById("title-input")?.value.trim() || "a4_export";
    const safeTitle = rawTitle.replace(/[^a-z0-9\-_\s]/gi, '').replace(/\s+/g, '_');
    const fileName = `${safeTitle}.png`;

    canvas.toBlob(function (blob) {
      const pngUrl = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = pngUrl;
      a.download = fileName;
      a.click();
      URL.revokeObjectURL(pngUrl);
    }, "image/png");

    URL.revokeObjectURL(url);
  };

  img.src = url;
}



function addWarningInfo(direction = "R") {
  const infoText = document.getElementById("info-text").value.trim();
  if (!infoText) return;

  const maxLineWidth = 120;
  const fontSize = 15;
  const lineHeight = 20;
  const padding = 6;
  const iconSize = 16;
  const gap = 6;

  function wrapText(text, maxWidth) {
    const words = text.split(" ");
    const lines = [];
    let currentLine = "";

    for (let word of words) {
      const testLine = currentLine ? currentLine + " " + word : word;
      const width = measureSVGTextWidth(testLine);
      if (width <= maxWidth) {
        currentLine = testLine;
      } else {
        if (currentLine) lines.push(currentLine);
        currentLine = word;
      }
    }
    if (currentLine) lines.push(currentLine);
    return lines;
  }

  const lines = wrapText(infoText, maxLineWidth);
  const textBlockWidth = maxLineWidth;
  const totalTextHeight = lines.length * lineHeight;
  const totalHeight = Math.max(iconSize, totalTextHeight);
  const totalWidth = iconSize + gap + textBlockWidth;

  const cx = 150;
  const cy = 360; // separate vertical space from general info
  const groupX = cx - totalWidth / 2;
  const groupY = cy - totalHeight / 2;

  const iconX = direction === "L" ? groupX + textBlockWidth + gap : groupX;
  const iconY = groupY + (totalHeight - iconSize) / 2;
  const textX = direction === "L" ? groupX : groupX + iconSize + gap;

  const group = document.createElementNS("http://www.w3.org/2000/svg", "g");
  group.setAttribute("class", "draggable-warning");
  group.setAttribute("cursor", "move");

  // Triangle icon
  const triangle = document.createElementNS("http://www.w3.org/2000/svg", "path");
  triangle.setAttribute("d", `
    M${iconX + iconSize / 2},${iconY}
    L${iconX + iconSize},${iconY + iconSize}
    L${iconX},${iconY + iconSize}
    Z
  `);
  triangle.setAttribute("fill", "#FFD700"); // bright yellow
  group.appendChild(triangle);

  // Exclamation mark
  const exclamation = document.createElementNS("http://www.w3.org/2000/svg", "text");
  exclamation.setAttribute("x", iconX + iconSize / 2);
  exclamation.setAttribute("y", iconY + iconSize * 0.75);
  exclamation.setAttribute("text-anchor", "middle");
  exclamation.setAttribute("dominant-baseline", "middle");
  exclamation.setAttribute("font-size", "14");
  exclamation.setAttribute("fill", "black");
  exclamation.setAttribute("font-family", "Source Code Pro, monospace");
  exclamation.textContent = "!";

  // Text block
  lines.forEach((line, i) => {
    const textEl = document.createElementNS("http://www.w3.org/2000/svg", "text");
    textEl.setAttribute("x", direction === "L" ? textX + maxLineWidth : textX);
    textEl.setAttribute("y", groupY + i * lineHeight + fontSize);
    textEl.setAttribute("fill", "#500B76");
    textEl.setAttribute("font-size", fontSize);
    textEl.setAttribute("font-family", "Source Code Pro, monospace");
    textEl.setAttribute("text-anchor", direction === "L" ? "end" : "start");
    textEl.textContent = line;
    group.appendChild(textEl);
  });

  group.appendChild(triangle);
  group.appendChild(exclamation);
  makeSVGElementDraggable(group);
  graphicsLayer.appendChild(group);
  saveComposerState()
}

function downloadA4SVG() {
  const exportSVG = document.createElementNS("http://www.w3.org/2000/svg", "svg");
  exportSVG.setAttribute("xmlns", "http://www.w3.org/2000/svg");
  exportSVG.setAttribute("viewBox", `0 0 ${A4_WIDTH} ${A4_HEIGHT}`);
  exportSVG.setAttribute("width", A4_WIDTH);
  exportSVG.setAttribute("height", A4_HEIGHT);
  exportSVG.setAttribute("preserveAspectRatio", "xMidYMid meet");
  const graphicsClone = graphicsLayer.cloneNode(true);
  const userClone = userLayer.cloneNode(true);
  exportSVG.appendChild(graphicsClone);
  exportSVG.appendChild(userClone);
  const svgString = new XMLSerializer().serializeToString(exportSVG);
  const blob = new Blob([svgString], { type: "image/svg+xml" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "a4_export.svg";
  a.click();
  URL.revokeObjectURL(url);
}

let deleteMode = false;

function enableDeleteMode() {
  deleteMode = !deleteMode;
  document.body.style.cursor = deleteMode ? "crosshair" : "default";
  alert(deleteMode ? "Click an element to delete it" : "Delete mode disabled");
}

graphicsLayer.addEventListener("click", function (e) {
  if (!deleteMode) return;

  let target = e.target;
  while (target && target.tagName !== "g" && target.tagName !== "svg") {
    target = target.parentNode;
  }

  if (target && target.tagName === "g") {
    target.remove();
  }

  deleteMode = false;
  document.body.style.cursor = "default";
});


function clearPage() {
  const confirmed = confirm("⚠️ This will remove everything on the page. Are you sure you want to clear all content?");
  if (!confirmed) return;

  graphicsLayer.innerHTML = "";
  userLayer.innerHTML = "";

  currentRotation = 0;
  scaleFactor = 1;
  translate = { x: 0, y: 0 };
  updateUserLayerTransform();

  localStorage.removeItem("composerSVG");
}

function addOpenSourceLogo() {
  const svgNS = "http://www.w3.org/2000/svg";
  const group = document.createElementNS(svgNS, "g");
  group.setAttribute("transform", "translate(860, 600) scale(3)");

  // Open Source Icon (Gear/Keyhole)
  const path = document.createElementNS(svgNS, "path");
  path.setAttribute("d", "M12 2c5.523 0 10 4.477 10 10 0 4.13-2.504 7.676-6.077 9.201l-2.518-6.55C14.354 14.148 15 13.15 15 12c0-1.657-1.343-3-3-3s-3 1.343-3 3c0 1.15.647 2.148 1.596 2.652l-2.518 6.55C4.504 19.675 2 16.13 2 12 2 6.477 6.477 2 12 2z");
  path.setAttribute("fill", "#500B76");
  group.appendChild(path);

  // === Creative Commons Icon (outline circle + CC in purple) ===
  const ccGroup = document.createElementNS(svgNS, "g");
  ccGroup.setAttribute("transform", "translate(25, 0)");

  const outer = document.createElementNS(svgNS, "circle");
  outer.setAttribute("cx", "12");
  outer.setAttribute("cy", "12");
  outer.setAttribute("r", "10");
  outer.setAttribute("fill", "none");
  outer.setAttribute("stroke", "#500B76");
  outer.setAttribute("stroke-width", "2.5");
  ccGroup.appendChild(outer);

  // Centered CC letters
  const c1 = document.createElementNS(svgNS, "text");
  c1.setAttribute("x", "6");
  c1.setAttribute("y", "15");
  c1.setAttribute("font-size", "10");
  c1.setAttribute("font-family", "Source Code Pro, monospace");
  c1.setAttribute("font-weight", "bold");
  c1.setAttribute("fill", "#500B76");
  c1.textContent = "C";
  ccGroup.appendChild(c1);

  const c2 = document.createElementNS(svgNS, "text");
  c2.setAttribute("x", "11.5");
  c2.setAttribute("y", "15");
  c2.setAttribute("font-size", "10");
  c2.setAttribute("font-family", "Source Code Pro, monospace");
  c2.setAttribute("font-weight", "bold");
  c2.setAttribute("fill", "#500B76");
  c2.textContent = "C";
  ccGroup.appendChild(c2);

  group.appendChild(ccGroup);

  // License description text (purple, bold)
  const lines = [
    "This work is licensed under the Creative Commons",
    "Attribution-ShareAlike 4.0 International.",
    "To view a copy of this license, visit",
    "http://creativecommons.org/licenses/by-sa/4.0/",
    "or send a letter to Creative Commons,",
    "PO Box 1866, Mountain View, CA 94042, USA."
  ];

  lines.forEach((line, i) => {
    const textEl = document.createElementNS(svgNS, "text");
    textEl.setAttribute("x", "0");
    textEl.setAttribute("y", `${30 + i * 5}`);
    textEl.setAttribute("font-size", "3");
    textEl.setAttribute("fill", "#500B76");
    textEl.setAttribute("font-family", "Source Code Pro, monospace");
    textEl.setAttribute("font-weight", "bold");
    textEl.textContent = line;
    group.appendChild(textEl);
  });

  graphicsLayer.appendChild(group);
  saveComposerState();
}

</script>

</body>
</html>
